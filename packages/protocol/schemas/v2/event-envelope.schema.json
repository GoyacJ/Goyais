{
  "$id": "goyais.protocol.v2.event-envelope",
  "type": "object",
  "required": ["protocol_version", "trace_id", "event_id", "execution_id", "seq", "ts", "type", "payload"],
  "properties": {
    "protocol_version": { "const": "2.0.0" },
    "trace_id": { "type": "string", "minLength": 1 },
    "event_id": { "type": "string", "minLength": 1 },
    "execution_id": { "type": "string", "minLength": 1 },
    "seq": { "type": "integer", "minimum": 1 },
    "ts": { "type": "string", "format": "date-time" },
    "type": {
      "enum": [
        "plan",
        "tool_call",
        "tool_result",
        "patch",
        "error",
        "done",
        "text_delta",
        "heartbeat",
        "confirmation_request",
        "confirmation_decision",
        "cancelled"
      ]
    },
    "payload": { "type": "object" }
  },
  "allOf": [
    {
      "if": { "properties": { "type": { "const": "plan" } }, "required": ["type"] },
      "then": { "properties": { "payload": { "$ref": "goyais.protocol.v2.event-payload-plan" } } }
    },
    {
      "if": { "properties": { "type": { "const": "tool_call" } }, "required": ["type"] },
      "then": { "properties": { "payload": { "$ref": "goyais.protocol.v2.event-payload-tool-call" } } }
    },
    {
      "if": { "properties": { "type": { "const": "tool_result" } }, "required": ["type"] },
      "then": { "properties": { "payload": { "$ref": "goyais.protocol.v2.event-payload-tool-result" } } }
    },
    {
      "if": { "properties": { "type": { "const": "patch" } }, "required": ["type"] },
      "then": { "properties": { "payload": { "$ref": "goyais.protocol.v2.event-payload-patch" } } }
    },
    {
      "if": { "properties": { "type": { "const": "error" } }, "required": ["type"] },
      "then": { "properties": { "payload": { "$ref": "goyais.protocol.v2.event-payload-error" } } }
    },
    {
      "if": { "properties": { "type": { "const": "done" } }, "required": ["type"] },
      "then": { "properties": { "payload": { "$ref": "goyais.protocol.v2.event-payload-done" } } }
    }
  ],
  "additionalProperties": false
}
